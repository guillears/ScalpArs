<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCALPARS - Automated Trading Platform</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü§ñ</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1a1a2e',
                        secondary: '#16213e',
                        accent: '#0f3460',
                        success: '#10b981',
                        danger: '#ef4444',
                        warning: '#f59e0b',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
        }
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .pulse-green {
            animation: pulse-green 2s infinite;
        }
        @keyframes pulse-green {
            0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(16, 185, 129, 0); }
        }
        .pulse-yellow {
            animation: pulse-yellow 2s infinite;
        }
        @keyframes pulse-yellow {
            0%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(245, 158, 11, 0); }
        }
        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }
        .scrollbar-thin::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
        .tab-active {
            border-bottom: 2px solid #10b981;
            color: #10b981;
        }
    </style>
</head>
<body class="text-gray-100 font-sans">
    <!-- Toast Notification -->
    <div id="toast" class="fixed top-4 right-4 z-50 hidden">
        <div class="glass rounded-lg px-6 py-4 shadow-lg flex items-center space-x-3">
            <span id="toast-icon" class="text-2xl"></span>
            <span id="toast-message" class="font-medium"></span>
        </div>
    </div>

    <!-- Header -->
    <header class="glass sticky top-0 z-40">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-emerald-400 to-cyan-400 bg-clip-text text-transparent">
                        SCALPARS
                    </h1>
                    <div id="status-badge" class="flex items-center space-x-2 px-3 py-1 rounded-full bg-yellow-500/20 text-yellow-400">
                        <span id="status-dot" class="w-2 h-2 rounded-full bg-yellow-400 pulse-yellow"></span>
                        <span id="status-text" class="text-sm font-medium">PAUSED</span>
                    </div>
                </div>
                
                <div class="flex items-center space-x-6">
                    <!-- Paper Trading Toggle -->
                    <div class="flex items-center space-x-2">
                        <span class="text-sm text-gray-400">Paper</span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="paper-toggle" class="sr-only peer" checked>
                            <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500"></div>
                        </label>
                        <span class="text-sm text-gray-400">Live</span>
                    </div>
                    
                    <!-- Timer -->
                    <div class="flex items-center space-x-2 text-lg font-mono">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span id="timer" class="text-white">00:00:00</span>
                    </div>
                    
                    <!-- Control Button -->
                    <button id="control-btn" onclick="toggleBot()" class="px-6 py-2 rounded-lg font-semibold transition-all duration-200 bg-emerald-500 hover:bg-emerald-600 text-white flex items-center space-x-2">
                        <svg id="control-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span id="control-text">Start Bot</span>
                    </button>
                    
                    <!-- Reset Button -->
                    <button onclick="resetBot()" class="px-6 py-2 rounded-lg font-semibold transition-all duration-200 bg-red-500 hover:bg-red-600 text-white flex items-center space-x-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        <span>Reset</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-6 py-8 space-y-8">
        <!-- Balance Cards -->
        <section>
            <h2 class="text-lg font-semibold text-gray-300 mb-4">Account Balance</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="glass rounded-xl p-5">
                    <p class="text-sm text-gray-400 mb-1">USDT Balance</p>
                    <p id="usdt-balance" class="text-2xl font-bold text-white">$0.00</p>
                </div>
                <div class="glass rounded-xl p-5">
                    <p class="text-sm text-gray-400 mb-1">BNB Balance</p>
                    <p id="bnb-balance" class="text-2xl font-bold text-white">0.0000</p>
                </div>
                <div class="glass rounded-xl p-5">
                    <p class="text-sm text-gray-400 mb-1">USDT in Open Orders</p>
                    <p id="usdt-orders" class="text-2xl font-bold text-yellow-400">$0.00</p>
                </div>
                <div class="glass rounded-xl p-5">
                    <p class="text-sm text-gray-400 mb-1">Total Portfolio Value</p>
                    <p id="total-portfolio" class="text-2xl font-bold text-emerald-400">$0.00</p>
                </div>
            </div>
        </section>

        <!-- Performance Metrics -->
        <section>
            <h2 class="text-lg font-semibold text-gray-300 mb-4">Closed Orders Performance</h2>
            <div class="glass rounded-xl p-6">
                <p class="text-xs text-gray-500 mb-4">All metrics below are calculated from closed orders only</p>
                
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6">
                    <!-- Row 1 -->
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Total Trades</p>
                        <p id="perf-total-trades" class="text-xl font-bold">0</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Total Longs</p>
                        <p id="perf-total-longs" class="text-xl font-bold text-emerald-400">0</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Total Shorts</p>
                        <p id="perf-total-shorts" class="text-xl font-bold text-red-400">0</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Win Rate</p>
                        <p id="perf-win-rate" class="text-xl font-bold">0%</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Win Rate Longs</p>
                        <p id="perf-win-rate-longs" class="text-xl font-bold text-emerald-400">0%</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Win Rate Shorts</p>
                        <p id="perf-win-rate-shorts" class="text-xl font-bold text-red-400">0%</p>
                    </div>
                    
                    <!-- Row 2 -->
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Avg. Win</p>
                        <p id="perf-avg-win" class="text-xl font-bold text-emerald-400">$0.00</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Avg. Win Long</p>
                        <p id="perf-avg-win-long" class="text-xl font-bold text-emerald-400">$0.00</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Avg. Win Short</p>
                        <p id="perf-avg-win-short" class="text-xl font-bold text-emerald-400">$0.00</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Avg. Loss</p>
                        <p id="perf-avg-loss" class="text-xl font-bold text-red-400">$0.00</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Avg. Loss Long</p>
                        <p id="perf-avg-loss-long" class="text-xl font-bold text-red-400">$0.00</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Avg. Loss Short</p>
                        <p id="perf-avg-loss-short" class="text-xl font-bold text-red-400">$0.00</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Best Win Long</p>
                        <p id="perf-best-win-long" class="text-xl font-bold text-emerald-400">$0.00</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Best Win Short</p>
                        <p id="perf-best-win-short" class="text-xl font-bold text-emerald-400">$0.00</p>
                    </div>
                    
                    <!-- Row 3 -->
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Worst Loss Long</p>
                        <p id="perf-worst-loss-long" class="text-xl font-bold text-red-400">$0.00</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Worst Loss Short</p>
                        <p id="perf-worst-loss-short" class="text-xl font-bold text-red-400">$0.00</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Total P&L (Investment)</p>
                        <p id="perf-total-pnl" class="text-xl font-bold">$0.00 (0%)</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Total P&L (Notional)</p>
                        <p id="perf-total-pnl-notional" class="text-xl font-bold">$0.00 (0%)</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Total Fees</p>
                        <p id="perf-total-fees" class="text-xl font-bold text-yellow-400">$0.00</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Avg. Leverage</p>
                        <p id="perf-avg-leverage" class="text-xl font-bold">0x</p>
                    </div>
                    
                    <!-- Row 4 -->
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Total Investment (Inv)</p>
                        <p id="perf-total-investment" class="text-xl font-bold">$0.00</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Total Investment Long (Inv)</p>
                        <p id="perf-investment-long" class="text-xl font-bold">$0.00</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Total Investment Short (Inv)</p>
                        <p id="perf-investment-short" class="text-xl font-bold">$0.00</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Avg. Duration</p>
                        <p id="perf-avg-duration" class="text-xl font-bold">00:00:00</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Avg. Duration Long</p>
                        <p id="perf-avg-duration-long" class="text-xl font-bold">00:00:00</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Avg. Duration Short</p>
                        <p id="perf-avg-duration-short" class="text-xl font-bold">00:00:00</p>
                    </div>
                    
                    <!-- Row: Capital Efficiency -->
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Return Multiple</p>
                        <p id="perf-return-multiple" class="text-xl font-bold">0x</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Daily Compound Return</p>
                        <p id="perf-daily-compound" class="text-xl font-bold">0%</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Runtime (Days)</p>
                        <p id="perf-runtime-days" class="text-xl font-bold">0</p>
                    </div>
                </div>
                
                <!-- Performance by Confidence Level -->
                <div class="mt-6 pt-6 border-t border-white/10">
                    <h3 class="text-sm font-semibold text-gray-300 mb-4">Performance by Confidence Level</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="text-gray-400 text-left border-b border-white/10">
                                    <th class="px-3 py-2 font-medium">Confidence</th>
                                    <th class="px-3 py-2 font-medium text-center">Trades</th>
                                    <th class="px-3 py-2 font-medium text-right">Total P&L</th>
                                    <th class="px-3 py-2 font-medium text-right">Total Win%</th>
                                    <th class="px-3 py-2 font-medium text-right">R:R</th>
                                    <th class="px-3 py-2 font-medium text-right">Long P&L</th>
                                    <th class="px-3 py-2 font-medium text-right">Long %</th>
                                    <th class="px-3 py-2 font-medium text-right">Long Win%</th>
                                    <th class="px-3 py-2 font-medium text-right">Short P&L</th>
                                    <th class="px-3 py-2 font-medium text-right">Short %</th>
                                    <th class="px-3 py-2 font-medium text-right">Short Win%</th>
                                    <th class="px-3 py-2 font-medium text-right">Avg Gap</th>
                                </tr>
                            </thead>
                            <tbody id="confidence-perf-body" class="divide-y divide-white/5">
                                <tr><td colspan="12" class="px-3 py-4 text-center text-gray-500">No data</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Trade Outcome Distribution and Closing Reason Summary - Side by Side -->
                <div class="mt-6 pt-6 border-t border-white/10 grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Trade Outcome Distribution -->
                    <div>
                        <h3 class="text-sm font-semibold text-gray-300 mb-4">Trade Outcome Distribution</h3>
                        <p class="text-xs text-gray-500 mb-3">Helps visualize trade quality and spot outliers</p>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="text-gray-400 text-left border-b border-white/10">
                                        <th class="px-3 py-2 font-medium">Return Range</th>
                                        <th class="px-3 py-2 font-medium text-center"># of Trades</th>
                                        <th class="px-3 py-2 font-medium text-right">Avg P&L USD</th>
                                    </tr>
                                </thead>
                                <tbody id="outcome-distribution-body" class="divide-y divide-white/5">
                                    <tr><td colspan="3" class="px-3 py-4 text-center text-gray-500">No data</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Closing Reason Summary -->
                    <div>
                        <h3 class="text-sm font-semibold text-gray-300 mb-4">Closing Reason Summary</h3>
                        <p class="text-xs text-gray-500 mb-3">Performance by close reason (L = TP Level reached)</p>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="text-gray-400 text-left border-b border-white/10">
                                        <th class="px-3 py-2 font-medium">Close Reason</th>
                                        <th class="px-3 py-2 font-medium text-center"># Trades</th>
                                        <th class="px-3 py-2 font-medium text-center">Confidence</th>
                                        <th class="px-3 py-2 font-medium text-right">Avg P&L %</th>
                                        <th class="px-3 py-2 font-medium text-right">Avg P&L USD</th>
                                    </tr>
                                </thead>
                                <tbody id="close-reason-body" class="divide-y divide-white/5">
                                    <tr><td colspan="5" class="px-3 py-4 text-center text-gray-500">No data</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Performance by Entry Gap -->
                <div class="mt-6 pt-6 border-t border-white/10">
                    <h3 class="text-sm font-semibold text-gray-300 mb-4">Performance by Entry Gap</h3>
                    <p class="text-xs text-gray-500 mb-3">Win rate and P&L by EMA gap range at entry (only tracks new trades)</p>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="text-gray-400 text-left border-b border-white/10">
                                    <th class="px-3 py-2 font-medium">Gap Range</th>
                                    <th class="px-3 py-2 font-medium text-center"># Trades</th>
                                    <th class="px-3 py-2 font-medium text-right">Win Rate</th>
                                    <th class="px-3 py-2 font-medium text-right">Total P&L</th>
                                    <th class="px-3 py-2 font-medium text-right">Avg P&L USD</th>
                                    <th class="px-3 py-2 font-medium text-center">Confidence</th>
                                </tr>
                            </thead>
                            <tbody id="gap-performance-body" class="divide-y divide-white/5">
                                <tr><td colspan="6" class="px-3 py-4 text-center text-gray-500">No data (collecting entry gaps)</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Top 50 Pairs Table -->
        <section>
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center space-x-3">
                    <h2 class="text-lg font-semibold text-gray-300">Top Pairs by Volume</h2>
                    <select id="top-pairs-limit" onchange="updateTradingPairsLimit()" class="bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-sm">
                        <option value="5">Top 5</option>
                        <option value="10">Top 10</option>
                        <option value="20">Top 20</option>
                        <option value="50" selected>Top 50</option>
                    </select>
                    <span class="text-xs text-yellow-400/80 ml-2">‚Üê Only these pairs can open trades</span>
                </div>
                <div class="flex items-center space-x-2 text-sm text-gray-500">
                    <span>Auto-refresh: 10s</span>
                    <button onclick="refreshPairs()" class="px-3 py-1 glass rounded-lg hover:bg-white/10 transition">
                        Refresh Now
                    </button>
                </div>
            </div>
            <div class="glass rounded-xl overflow-hidden">
                <div class="overflow-x-auto scrollbar-thin max-h-96 overflow-y-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-white/5 sticky top-0">
                            <tr class="text-gray-400 text-left">
                                <th class="px-4 py-3 font-medium">Pair</th>
                                <th class="px-4 py-3 font-medium text-right">Volume 24h</th>
                                <th class="px-4 py-3 font-medium text-right">Price</th>
                                <th class="px-4 py-3 font-medium text-right">EMA5</th>
                                <th class="px-4 py-3 font-medium text-right">EMA8</th>
                                <th class="px-4 py-3 font-medium text-right">EMA13</th>
                                <th class="px-4 py-3 font-medium text-right">EMA20</th>
                                <th class="px-4 py-3 font-medium text-right">Gap %</th>
                                <th class="px-4 py-3 font-medium text-right">RSI(12)</th>
                                <th class="px-4 py-3 font-medium text-right">ADX</th>
                                <th class="px-4 py-3 font-medium text-center">Confidence</th>
                                <th class="px-4 py-3 font-medium text-center">Signal</th>
                                <th class="px-4 py-3 font-medium text-center">Open Positions</th>
                            </tr>
                        </thead>
                        <tbody id="pairs-table-body" class="divide-y divide-white/5">
                            <tr>
                                <td colspan="13" class="px-4 py-8 text-center text-gray-500">Loading pairs data...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Orders Tabs -->
        <section>
            <div class="flex items-center space-x-8 border-b border-white/10 mb-4">
                <button onclick="switchOrdersTab('transactions')" id="tab-transactions" class="px-4 py-3 text-sm font-medium text-gray-400 hover:text-white transition tab-active">
                    Transactions
                </button>
                <button onclick="switchOrdersTab('open')" id="tab-open" class="px-4 py-3 text-sm font-medium text-gray-400 hover:text-white transition">
                    Open Orders
                </button>
                <button onclick="switchOrdersTab('closed')" id="tab-closed" class="px-4 py-3 text-sm font-medium text-gray-400 hover:text-white transition">
                    Closed Orders
                </button>
            </div>
            
            <!-- Transactions Tab -->
            <div id="content-transactions" class="glass rounded-xl overflow-hidden">
                <div class="overflow-x-auto scrollbar-thin max-h-80 overflow-y-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-white/5 sticky top-0">
                            <tr class="text-gray-400 text-left">
                                <th class="px-4 py-3 font-medium">Time</th>
                                <th class="px-4 py-3 font-medium">Order ID</th>
                                <th class="px-4 py-3 font-medium">Pair</th>
                                <th class="px-4 py-3 font-medium">Confidence</th>
                                <th class="px-4 py-3 font-medium">Action</th>
                                <th class="px-4 py-3 font-medium text-right">Quantity</th>
                                <th class="px-4 py-3 font-medium text-right">Price</th>
                                <th class="px-4 py-3 font-medium text-right">Investment</th>
                                <th class="px-4 py-3 font-medium text-right">Leverage</th>
                                <th class="px-4 py-3 font-medium text-right">Notional</th>
                                <th class="px-4 py-3 font-medium text-right">Fee</th>
                            </tr>
                        </thead>
                        <tbody id="transactions-table-body" class="divide-y divide-white/5">
                            <tr>
                                <td colspan="11" class="px-4 py-8 text-center text-gray-500">No transactions yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Open Orders Tab -->
            <div id="content-open" class="glass rounded-xl overflow-hidden hidden">
                <div class="overflow-x-auto scrollbar-thin max-h-80 overflow-y-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-white/5 sticky top-0">
                            <tr class="text-gray-400 text-left">
                                <th class="px-4 py-3 font-medium">Time</th>
                                <th class="px-4 py-3 font-medium">Pair</th>
                                <th class="px-4 py-3 font-medium">Confidence</th>
                                <th class="px-4 py-3 font-medium">Direction</th>
                                <th class="px-4 py-3 font-medium text-right">Investment</th>
                                <th class="px-4 py-3 font-medium text-right">Leverage</th>
                                <th class="px-4 py-3 font-medium text-right">Notional</th>
                                <th class="px-4 py-3 font-medium text-right">Entry</th>
                                <th class="px-4 py-3 font-medium text-right">Current</th>
                                <th class="px-4 py-3 font-medium text-right">Fee</th>
                                <th class="px-4 py-3 font-medium text-right">High/Low</th>
                                <th class="px-4 py-3 font-medium text-right">Drop %</th>
                                <th class="px-4 py-3 font-medium text-right">P&L</th>
                                <th class="px-4 py-3 font-medium text-center">TP Level</th>
                                <th class="px-4 py-3 font-medium text-right">Duration</th>
                                <th class="px-4 py-3 font-medium text-center">Action</th>
                            </tr>
                        </thead>
                        <tbody id="open-orders-table-body" class="divide-y divide-white/5">
                            <tr>
                                <td colspan="16" class="px-4 py-8 text-center text-gray-500">No open orders</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Closed Orders Tab -->
            <div id="content-closed" class="glass rounded-xl overflow-hidden hidden">
                <div class="overflow-x-auto scrollbar-thin max-h-80 overflow-y-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-white/5 sticky top-0">
                            <tr class="text-gray-400 text-left">
                                <th class="px-4 py-3 font-medium">Opened</th>
                                <th class="px-4 py-3 font-medium">Closed</th>
                                <th class="px-4 py-3 font-medium">Pair</th>
                                <th class="px-4 py-3 font-medium">Confidence</th>
                                <th class="px-4 py-3 font-medium">Direction</th>
                                <th class="px-4 py-3 font-medium text-right">Investment</th>
                                <th class="px-4 py-3 font-medium text-right">Leverage</th>
                                <th class="px-4 py-3 font-medium text-right">Entry</th>
                                <th class="px-4 py-3 font-medium text-right">Exit</th>
                                <th class="px-4 py-3 font-medium text-right">Total Fee</th>
                                <th class="px-4 py-3 font-medium text-right">P&L</th>
                                <th class="px-4 py-3 font-medium text-center">TP Level</th>
                                <th class="px-4 py-3 font-medium text-right">Duration</th>
                                <th class="px-4 py-3 font-medium">Reason</th>
                            </tr>
                        </thead>
                        <tbody id="closed-orders-table-body" class="divide-y divide-white/5">
                            <tr>
                                <td colspan="14" class="px-4 py-8 text-center text-gray-500">No closed orders</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Configuration Panel -->
        <section>
            <h2 class="text-lg font-semibold text-gray-300 mb-4">Trading Configuration</h2>
            <div class="glass rounded-xl p-6 space-y-8">
                
                <!-- Investment Settings -->
                <div>
                    <h3 class="text-md font-semibold text-gray-200 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Investment Settings
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Investment Mode</label>
                            <select id="config-investment-mode" class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-emerald-500">
                                <option value="percentage">Percentage of Balance</option>
                                <option value="fixed">Fixed Amount</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Investment Value</label>
                            <div class="flex">
                                <input type="number" id="config-investment-value" class="flex-1 bg-white/5 border border-white/10 rounded-l-lg px-4 py-2 text-white focus:outline-none focus:border-emerald-500" value="5">
                                <span id="config-investment-unit" class="bg-white/10 border border-white/10 border-l-0 rounded-r-lg px-4 py-2 text-gray-400">%</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Trading Fee (per side)</label>
                            <div class="flex">
                                <input type="number" id="config-trading-fee" step="0.0001" class="flex-1 bg-white/5 border border-white/10 rounded-l-lg px-4 py-2 text-white focus:outline-none focus:border-emerald-500" value="0.0004">
                                <span class="bg-white/10 border border-white/10 border-l-0 rounded-r-lg px-4 py-2 text-gray-400">%</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Applied to both entry & exit (total: 2x)</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-4">
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Reserve Mode</label>
                            <select id="config-reserve-mode" class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-emerald-500">
                                <option value="percentage">Percentage</option>
                                <option value="fixed">Fixed Amount</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Reserve Value</label>
                            <div class="flex">
                                <input type="number" id="config-reserve-value" class="flex-1 bg-white/5 border border-white/10 rounded-l-lg px-4 py-2 text-white focus:outline-none focus:border-emerald-500" value="20">
                                <span id="config-reserve-unit" class="bg-white/10 border border-white/10 border-l-0 rounded-r-lg px-4 py-2 text-gray-400">%</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Paper Balance</label>
                            <div class="flex">
                                <input type="number" id="config-paper-balance" class="flex-1 bg-white/5 border border-white/10 rounded-l-lg px-4 py-2 text-white focus:outline-none focus:border-emerald-500" value="10000">
                                <span class="bg-white/10 border border-white/10 border-l-0 rounded-r-lg px-4 py-2 text-gray-400">USDT</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Cooldown After Loss</label>
                            <div class="flex">
                                <input type="number" id="config-cooldown-loss" min="0" max="60" class="flex-1 bg-white/5 border border-white/10 rounded-l-lg px-4 py-2 text-white focus:outline-none focus:border-emerald-500" value="5">
                                <span class="bg-white/10 border border-white/10 border-l-0 rounded-r-lg px-4 py-2 text-gray-400">min</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Wait before re-entering same pair after loss</p>
                        </div>
                    </div>
                    
                    <!-- Position & Size Limits -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-4">
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Max Open Positions</label>
                            <input type="number" id="config-max-positions" min="1" max="999" class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-emerald-500" value="100">
                            <p class="text-xs text-gray-500 mt-1">Max simultaneous open positions</p>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Min Investment Size</label>
                            <div class="flex">
                                <input type="number" id="config-min-investment" min="1" step="1" class="flex-1 bg-white/5 border border-white/10 rounded-l-lg px-4 py-2 text-white focus:outline-none focus:border-emerald-500" value="100">
                                <span class="bg-white/10 border border-white/10 border-l-0 rounded-r-lg px-4 py-2 text-gray-400">USD</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Minimum investment per trade</p>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Max Investment Size</label>
                            <div class="flex">
                                <input type="number" id="config-max-investment" min="1" step="1" class="flex-1 bg-white/5 border border-white/10 rounded-l-lg px-4 py-2 text-white focus:outline-none focus:border-emerald-500" value="50000">
                                <span class="bg-white/10 border border-white/10 border-l-0 rounded-r-lg px-4 py-2 text-gray-400">USD</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Maximum investment per trade</p>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Max Holding Time</label>
                            <div class="flex">
                                <input type="number" id="config-max-holding-time" min="0" step="1" class="flex-1 bg-white/5 border border-white/10 rounded-l-lg px-4 py-2 text-white focus:outline-none focus:border-emerald-500" value="180">
                                <span class="bg-white/10 border border-white/10 border-l-0 rounded-r-lg px-4 py-2 text-gray-400">min</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Auto-close after this time (0 = disabled)</p>
                        </div>
                    </div>
                </div>

                <!-- Signal Thresholds -->
                <div>
                    <h3 class="text-md font-semibold text-gray-200 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        Signal Thresholds
                    </h3>
                    
                    <!-- RSI Thresholds Table -->
                    <div class="overflow-x-auto mb-6">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="text-gray-400 text-left border-b border-white/10">
                                    <th class="px-4 py-3 font-medium">Confidence</th>
                                    <th class="px-4 py-3 font-medium text-center text-emerald-400">LONG RSI ‚â§</th>
                                    <th class="px-4 py-3 font-medium text-center text-red-400">SHORT RSI ‚â•</th>
                                    <th class="px-4 py-3 font-medium text-center text-cyan-400">ADX ‚â•</th>
                                    <th class="px-4 py-3 font-medium">Conditions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-white/5">
                                <tr>
                                    <td class="px-4 py-3">
                                        <span class="flex items-center">
                                            <span class="w-3 h-3 rounded-full bg-yellow-400 mr-2"></span>
                                            LOW
                                        </span>
                                    </td>
                                    <td class="px-4 py-3 text-center">
                                        <input type="number" id="config-long-rsi-low" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center" value="40">
                                    </td>
                                    <td class="px-4 py-3 text-center">
                                        <input type="number" id="config-short-rsi-low" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center" value="60">
                                    </td>
                                    <td class="px-4 py-3 text-center">
                                        <input type="number" id="config-adx-low" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center" value="15">
                                    </td>
                                    <td class="px-4 py-3 text-xs text-gray-400">EMA stacked + ADX 15-20</td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3">
                                        <span class="flex items-center">
                                            <span class="w-3 h-3 rounded-full bg-orange-400 mr-2"></span>
                                            MEDIUM
                                        </span>
                                    </td>
                                    <td class="px-4 py-3 text-center">
                                        <input type="number" id="config-long-rsi-medium" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center" value="35">
                                    </td>
                                    <td class="px-4 py-3 text-center">
                                        <input type="number" id="config-short-rsi-medium" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center" value="65">
                                    </td>
                                    <td class="px-4 py-3 text-center">
                                        <input type="number" id="config-adx-medium" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center" value="20">
                                    </td>
                                    <td class="px-4 py-3 text-xs text-gray-400">EMA stacked + ADX 20-25</td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3">
                                        <span class="flex items-center">
                                            <span class="w-3 h-3 rounded-full bg-emerald-400 mr-2"></span>
                                            HIGH
                                        </span>
                                    </td>
                                    <td class="px-4 py-3 text-center">
                                        <input type="number" id="config-long-rsi-high" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center" value="30">
                                    </td>
                                    <td class="px-4 py-3 text-center">
                                        <input type="number" id="config-short-rsi-high" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center" value="70">
                                    </td>
                                    <td class="px-4 py-3 text-center">
                                        <input type="number" id="config-adx-high" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center" value="25">
                                    </td>
                                    <td class="px-4 py-3 text-xs text-gray-400">EMA stacked + ADX > 25</td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3">
                                        <span class="flex items-center">
                                            <span class="w-3 h-3 rounded-full bg-blue-400 mr-2"></span>
                                            EXTREME
                                        </span>
                                    </td>
                                    <td class="px-4 py-3 text-center">
                                        <input type="number" id="config-long-rsi-extreme" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center" value="30">
                                    </td>
                                    <td class="px-4 py-3 text-center">
                                        <input type="number" id="config-short-rsi-extreme" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center" value="70">
                                    </td>
                                    <td class="px-4 py-3 text-center">
                                        <input type="number" id="config-adx-extreme" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center" value="35">
                                    </td>
                                    <td class="px-4 py-3 text-xs text-gray-400">+ Volume > <input type="number" step="0.1" id="config-volume-mult" class="w-12 bg-white/5 border border-white/10 rounded px-1 py-0.5 text-white text-center text-xs mx-1" value="1.5">x avg</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <p class="text-xs text-gray-500">LONG signals require RSI at or below threshold (oversold). SHORT signals require RSI at or above threshold (overbought). EMA stacking is always required.</p>
                    <p class="text-xs text-gray-500 mt-1">EMA Stacked for LONG: EMA5 &gt; EMA8 &gt; EMA13 &gt; EMA20 (bullish). EMA Stacked for SHORT: EMA5 &lt; EMA8 &lt; EMA13 &lt; EMA20 (bearish).</p>
                </div>

                <!-- Confidence Levels -->
                <div>
                    <h3 class="text-md font-semibold text-gray-200 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        Confidence Levels & Risk Management
                    </h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="text-gray-400 text-left border-b border-white/10">
                                    <th class="px-3 py-3 font-medium">Confidence</th>
                                    <th class="px-3 py-3 font-medium text-center">Mode</th>
                                    <th class="px-3 py-3 font-medium text-center">Leverage</th>
                                    <th class="px-3 py-3 font-medium text-center">Multiplier</th>
                                    <th class="px-3 py-3 font-medium text-center">Stop Loss</th>
                                    <th class="px-3 py-3 font-medium text-center">TP Min</th>
                                    <th class="px-3 py-3 font-medium text-center">Pullback</th>
                                    <th class="px-3 py-3 font-medium text-center" title="Minimum gap % required (EMA5-EMA20)/price">Gap Min</th>
                                    <th class="px-3 py-3 font-medium text-center" title="Maximum gap % allowed (filters overextended entries)">Gap Max</th>
                                    <th class="px-3 py-3 font-medium text-center">Gap?</th>
                                    <th class="px-3 py-3 font-medium text-center text-amber-400" title="Break-even trigger: once peak P&L reaches this %, SL moves to BE Offset">BE Trig</th>
                                    <th class="px-3 py-3 font-medium text-center text-amber-400" title="Break-even offset: new effective stop loss once break-even is active">BE Off</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-white/5">
                                <tr>
                                    <td class="px-3 py-3">
                                        <span class="flex items-center">
                                            <span class="w-3 h-3 rounded-full bg-yellow-400 mr-2"></span>
                                            LOW
                                        </span>
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <select id="config-low-mode" class="bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-xs">
                                            <option value="disabled">Disabled</option>
                                            <option value="both">Both</option>
                                            <option value="long">Long</option>
                                            <option value="short">Short</option>
                                        </select>
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" id="config-low-leverage" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="3">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.1" id="config-low-multiplier" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="1.0">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.1" id="config-low-sl" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="-0.4">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.01" id="config-low-tp" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="0.6">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.01" id="config-low-pb" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="0.3">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.01" id="config-low-gap-min" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="0.08">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.01" id="config-low-gap-max" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="0.40">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="checkbox" id="config-low-gap-enabled" class="w-4 h-4 rounded bg-white/10 border-white/20 text-emerald-500 focus:ring-emerald-500" checked>
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.01" id="config-low-be-trigger" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="0.15">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.01" id="config-low-be-offset" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="-0.05">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-3 py-3">
                                        <span class="flex items-center">
                                            <span class="w-3 h-3 rounded-full bg-orange-400 mr-2"></span>
                                            MEDIUM
                                        </span>
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <select id="config-medium-mode" class="bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-xs">
                                            <option value="disabled">Disabled</option>
                                            <option value="both">Both</option>
                                            <option value="long">Long</option>
                                            <option value="short">Short</option>
                                        </select>
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" id="config-medium-leverage" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="5">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.1" id="config-medium-multiplier" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="1.5">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.1" id="config-medium-sl" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="-0.6">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.01" id="config-medium-tp" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="0.9">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.01" id="config-medium-pb" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="0.4">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.01" id="config-medium-gap-min" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="0.08">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.01" id="config-medium-gap-max" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="0.40">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="checkbox" id="config-medium-gap-enabled" class="w-4 h-4 rounded bg-white/10 border-white/20 text-emerald-500 focus:ring-emerald-500" checked>
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.01" id="config-medium-be-trigger" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="0.20">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.01" id="config-medium-be-offset" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="-0.05">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-3 py-3">
                                        <span class="flex items-center">
                                            <span class="w-3 h-3 rounded-full bg-emerald-400 mr-2"></span>
                                            HIGH
                                        </span>
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <select id="config-high-mode" class="bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-xs">
                                            <option value="disabled">Disabled</option>
                                            <option value="both">Both</option>
                                            <option value="long">Long</option>
                                            <option value="short">Short</option>
                                        </select>
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" id="config-high-leverage" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="10">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.1" id="config-high-multiplier" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="2.0">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.1" id="config-high-sl" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="-0.8">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.01" id="config-high-tp" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="1.2">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.01" id="config-high-pb" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="0.5">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.01" id="config-high-gap-min" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="0.08">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.01" id="config-high-gap-max" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="0.40">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="checkbox" id="config-high-gap-enabled" class="w-4 h-4 rounded bg-white/10 border-white/20 text-emerald-500 focus:ring-emerald-500">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.01" id="config-high-be-trigger" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="0.25">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.01" id="config-high-be-offset" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="-0.03">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-3 py-3">
                                        <span class="flex items-center">
                                            <span class="w-3 h-3 rounded-full bg-blue-400 mr-2"></span>
                                            EXTREME
                                        </span>
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <select id="config-extreme-mode" class="bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-xs">
                                            <option value="disabled">Disabled</option>
                                            <option value="both">Both</option>
                                            <option value="long">Long</option>
                                            <option value="short">Short</option>
                                        </select>
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" id="config-extreme-leverage" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="15">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.1" id="config-extreme-multiplier" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="2.5">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.1" id="config-extreme-sl" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="-1.0">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.01" id="config-extreme-tp" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="1.5">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.01" id="config-extreme-pb" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="0.6">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.01" id="config-extreme-gap-min" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="0.08">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.01" id="config-extreme-gap-max" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="0.40">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="checkbox" id="config-extreme-gap-enabled" class="w-4 h-4 rounded bg-white/10 border-white/20 text-emerald-500 focus:ring-emerald-500">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.01" id="config-extreme-be-trigger" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="0.30">
                                    </td>
                                    <td class="px-3 py-3 text-center">
                                        <input type="number" step="0.01" id="config-extreme-be-offset" class="w-16 bg-white/5 border border-white/10 rounded px-2 py-1 text-white text-center text-xs" value="-0.02">
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Save Button -->
                <div class="flex justify-end pt-4 border-t border-white/10">
                    <button onclick="saveConfig()" class="px-8 py-3 bg-emerald-500 hover:bg-emerald-600 rounded-lg font-semibold transition-all duration-200 flex items-center space-x-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span>Update Configuration</span>
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="glass mt-12 py-6">
        <div class="container mx-auto px-6 text-center text-gray-500 text-sm">
            <p>SCALPARS Trading Platform v1.0 - Trade responsibly</p>
        </div>
    </footer>

    <script>
        // State
        let isRunning = false;
        let isPaperMode = true;
        let timerInterval = null;
        let runtimeSeconds = 0;
        let currentTab = 'transactions';

        // API Base
        const API_BASE = '';

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadStatus();
            loadBalance();
            loadPerformance();
            loadPairs();
            loadTransactions();
            loadOpenOrders();
            loadClosedOrders();
            loadConfig();

            // Auto-refresh every 10 seconds
            setInterval(() => {
                loadBalance();
                loadPairs();
                loadOpenOrders();
                loadClosedOrders();
                loadPerformance();  // Update dashboard when orders close
                if (currentTab === 'transactions') loadTransactions();
            }, 10000);

            // Update open orders every 1 second for faster decision making
            setInterval(() => {
                loadOpenOrders();
            }, 1000);
        });

        // Toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toast-icon');
            const msg = document.getElementById('toast-message');
            
            icon.textContent = type === 'success' ? '‚úì' : '‚úó';
            icon.className = type === 'success' ? 'text-2xl text-emerald-400' : 'text-2xl text-red-400';
            msg.textContent = message;
            
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 3000);
        }

        // Format numbers
        function formatUSD(value) {
            return '$' + parseFloat(value || 0).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function formatPrice(value, decimals = 2) {
            if (value === null || value === undefined) return '-';
            const num = parseFloat(value);
            if (num >= 1000) return num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            if (num >= 1) return num.toFixed(decimals);
            return num.toPrecision(4);
        }

        function formatTime(isoString) {
            if (!isoString) return '-';
            // Ensure the timestamp is treated as UTC by adding 'Z' if missing
            // Check if it already has timezone info (Z, +HH:MM, or -HH:MM at the end)
            let utcString = isoString;
            if (!isoString.endsWith('Z') && !/[+-]\d{2}:\d{2}$/.test(isoString)) {
                utcString = isoString + 'Z';
            }
            const d = new Date(utcString);
            // Display in UTC-3 (Argentina timezone)
            return d.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit',
                timeZone: 'America/Argentina/Buenos_Aires'
            });
        }

        function getConfidenceClass(confidence) {
            switch (confidence) {
                case 'LOW': return 'text-yellow-400';
                case 'MEDIUM': return 'text-orange-400';
                case 'HIGH': return 'text-emerald-400';
                case 'EXTREME': return 'text-blue-400';
                default: return 'text-gray-400';
            }
        }

        // Update timer display
        function updateTimer(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            document.getElementById('timer').textContent = 
                `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        // Load bot status
        async function loadStatus() {
            try {
                const res = await fetch(`${API_BASE}/api/status`);
                const data = await res.json();
                
                isRunning = data.is_running;
                isPaperMode = data.is_paper_mode;
                runtimeSeconds = data.runtime_seconds;
                
                updateStatusUI();
                updateTimer(runtimeSeconds);
                
                // Update paper toggle
                document.getElementById('paper-toggle').checked = !isPaperMode;
                
                // Start timer if running
                if (isRunning && !timerInterval) {
                    timerInterval = setInterval(() => {
                        runtimeSeconds++;
                        updateTimer(runtimeSeconds);
                    }, 1000);
                }
            } catch (e) {
                console.error('Error loading status:', e);
            }
        }

        // Update status UI
        function updateStatusUI() {
            const badge = document.getElementById('status-badge');
            const dot = document.getElementById('status-dot');
            const text = document.getElementById('status-text');
            const btn = document.getElementById('control-btn');
            const btnText = document.getElementById('control-text');
            const btnIcon = document.getElementById('control-icon');
            
            if (isRunning) {
                badge.className = 'flex items-center space-x-2 px-3 py-1 rounded-full bg-emerald-500/20 text-emerald-400';
                dot.className = 'w-2 h-2 rounded-full bg-emerald-400 pulse-green';
                text.textContent = 'RUNNING';
                btn.className = 'px-6 py-2 rounded-lg font-semibold transition-all duration-200 bg-yellow-500 hover:bg-yellow-600 text-white flex items-center space-x-2';
                btnText.textContent = 'Pause Bot';
                btnIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>';
            } else {
                badge.className = 'flex items-center space-x-2 px-3 py-1 rounded-full bg-yellow-500/20 text-yellow-400';
                dot.className = 'w-2 h-2 rounded-full bg-yellow-400 pulse-yellow';
                text.textContent = 'PAUSED';
                btn.className = 'px-6 py-2 rounded-lg font-semibold transition-all duration-200 bg-emerald-500 hover:bg-emerald-600 text-white flex items-center space-x-2';
                btnText.textContent = 'Start Bot';
                btnIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>';
            }
        }

        // Toggle bot
        async function toggleBot() {
            try {
                const endpoint = isRunning ? '/api/pause' : '/api/start';
                const res = await fetch(`${API_BASE}${endpoint}`, { method: 'POST' });
                const data = await res.json();
                
                isRunning = !isRunning;
                updateStatusUI();
                
                if (isRunning) {
                    timerInterval = setInterval(() => {
                        runtimeSeconds++;
                        updateTimer(runtimeSeconds);
                    }, 1000);
                    showToast('Bot started successfully');
                } else {
                    clearInterval(timerInterval);
                    timerInterval = null;
                    showToast('Bot paused - will still close open positions');
                }
            } catch (e) {
                console.error('Error toggling bot:', e);
                showToast('Error toggling bot', 'error');
            }
        }

        async function resetBot() {
            const configResp = await fetch('/api/config');
            const configData = await configResp.json();
            const resetBalance = configData.paper_balance || 2000;
            if (!confirm(`Are you sure you want to reset paper trading?\n\nThis will:\n- Delete all orders and transactions\n- Reset balance to $${resetBalance.toLocaleString()}\n- Reset timer to 00:00:00`)) {
                return;
            }
            
            try {
                const res = await fetch(`${API_BASE}/api/reset`, { method: 'POST' });
                const data = await res.json();
                
                if (data.success) {
                    // Stop timer
                    clearInterval(timerInterval);
                    timerInterval = null;
                    runtimeSeconds = 0;
                    isRunning = false;
                    
                    // Update UI
                    updateTimer(0);
                    updateStatusUI();
                    
                    // Reload all data with slight delay to ensure DB is updated
                    setTimeout(() => {
                        loadBalance();
                        loadOpenOrders();
                        loadClosedOrders();
                        loadTransactions();
                        loadPerformance();
                    }, 500);
                    
                    showToast(`Paper trading reset successfully! Balance: $${resetBalance.toLocaleString()}`);
                    
                    // Force page reload after a short delay to ensure fresh data
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                } else {
                    showToast('Error resetting: ' + (data.message || 'Unknown error'), 'error');
                }
            } catch (e) {
                console.error('Error resetting bot:', e);
                showToast('Error resetting bot', 'error');
            }
        }

        // Toggle paper mode
        document.getElementById('paper-toggle').addEventListener('change', async (e) => {
            const enabled = !e.target.checked;
            try {
                await fetch(`${API_BASE}/api/paper-mode?enabled=${enabled}`, { method: 'POST' });
                isPaperMode = enabled;
                loadBalance();
                loadOpenOrders();
                loadClosedOrders();
                loadTransactions();
                loadPerformance();
                showToast(enabled ? 'Paper trading mode enabled' : 'Live trading mode enabled');
            } catch (err) {
                console.error('Error toggling paper mode:', err);
                e.target.checked = isPaperMode;
            }
        });

        // Load balance
        async function loadBalance() {
            try {
                const res = await fetch(`${API_BASE}/api/balance`);
                const data = await res.json();
                
                document.getElementById('usdt-balance').textContent = formatUSD(data.usdt_balance);
                document.getElementById('bnb-balance').textContent = parseFloat(data.bnb_balance || 0).toFixed(4);
                document.getElementById('usdt-orders').textContent = formatUSD(data.usdt_in_orders);
                document.getElementById('total-portfolio').textContent = formatUSD(data.total_portfolio);
            } catch (e) {
                console.error('Error loading balance:', e);
            }
        }

        // Load performance metrics
        async function loadPerformance() {
            try {
                const res = await fetch(`${API_BASE}/api/performance`);
                const data = await res.json();
                
                document.getElementById('perf-total-trades').textContent = data.total_trades;
                document.getElementById('perf-total-longs').textContent = data.total_longs;
                document.getElementById('perf-total-shorts').textContent = data.total_shorts;
                document.getElementById('perf-win-rate').textContent = data.win_rate + '%';
                document.getElementById('perf-win-rate-longs').textContent = data.win_rate_longs + '%';
                document.getElementById('perf-win-rate-shorts').textContent = data.win_rate_shorts + '%';
                document.getElementById('perf-avg-win').textContent = formatUSD(data.avg_win);
                document.getElementById('perf-avg-win-long').textContent = formatUSD(data.avg_win_long);
                document.getElementById('perf-avg-win-short').textContent = formatUSD(data.avg_win_short);
                document.getElementById('perf-avg-loss').textContent = formatUSD(data.avg_loss);
                document.getElementById('perf-avg-loss-long').textContent = formatUSD(data.avg_loss_long);
                document.getElementById('perf-avg-loss-short').textContent = formatUSD(data.avg_loss_short);
                document.getElementById('perf-best-win-long').textContent = formatUSD(data.best_win_long);
                document.getElementById('perf-best-win-short').textContent = formatUSD(data.best_win_short);
                document.getElementById('perf-worst-loss-long').textContent = formatUSD(data.worst_loss_long);
                document.getElementById('perf-worst-loss-short').textContent = formatUSD(data.worst_loss_short);
                
                const pnlEl = document.getElementById('perf-total-pnl');
                pnlEl.textContent = `${formatUSD(data.total_pnl)} (${data.total_pnl_percentage}%)`;
                pnlEl.className = `text-xl font-bold ${data.total_pnl >= 0 ? 'text-emerald-400' : 'text-red-400'}`;
                
                const pnlNotionalEl = document.getElementById('perf-total-pnl-notional');
                pnlNotionalEl.textContent = `${formatUSD(data.total_pnl)} (${data.total_pnl_notional_percentage}%)`;
                pnlNotionalEl.className = `text-xl font-bold ${data.total_pnl >= 0 ? 'text-emerald-400' : 'text-red-400'}`;
                
                document.getElementById('perf-total-fees').textContent = formatUSD(data.total_fees);
                document.getElementById('perf-avg-leverage').textContent = data.avg_leverage + 'x';
                document.getElementById('perf-total-investment').textContent = formatUSD(data.total_investment_value);
                document.getElementById('perf-investment-long').textContent = formatUSD(data.total_investment_long_value);
                document.getElementById('perf-investment-short').textContent = formatUSD(data.total_investment_short_value);
                document.getElementById('perf-avg-duration').textContent = data.avg_duration;
                document.getElementById('perf-avg-duration-long').textContent = data.avg_duration_long;
                document.getElementById('perf-avg-duration-short').textContent = data.avg_duration_short;
                
                const rmEl = document.getElementById('perf-return-multiple');
                rmEl.textContent = (data.return_multiple || 0).toFixed(4) + 'x';
                rmEl.className = `text-xl font-bold ${data.return_multiple >= 1 ? 'text-emerald-400' : 'text-red-400'}`;
                
                const dcrEl = document.getElementById('perf-daily-compound');
                const dcrVal = data.daily_compound_return || 0;
                dcrEl.textContent = (dcrVal >= 0 ? '+' : '') + dcrVal.toFixed(4) + '%';
                dcrEl.className = `text-xl font-bold ${dcrVal >= 0 ? 'text-emerald-400' : 'text-red-400'}`;
                
                document.getElementById('perf-runtime-days').textContent = (data.runtime_days || 0) + ' days';
                
                // Performance by confidence level
                const confBody = document.getElementById('confidence-perf-body');
                if (data.by_confidence) {
                    const confColors = {
                        'LOW': 'text-yellow-400',
                        'MEDIUM': 'text-orange-400',
                        'HIGH': 'text-emerald-400',
                        'EXTREME': 'text-blue-400'
                    };
                    
                    confBody.innerHTML = ['LOW', 'MEDIUM', 'HIGH', 'EXTREME'].map(conf => {
                        const c = data.by_confidence[conf];
                        if (!c || c.total_trades === 0) {
                            return `
                                <tr class="hover:bg-white/5">
                                    <td class="px-3 py-2 ${confColors[conf]} font-medium">${conf}</td>
                                    <td class="px-3 py-2 text-center text-gray-500">0</td>
                                    <td class="px-3 py-2 text-right text-gray-500">-</td>
                                    <td class="px-3 py-2 text-right text-gray-500">-</td>
                                    <td class="px-3 py-2 text-right text-gray-500">-</td>
                                    <td class="px-3 py-2 text-right text-gray-500">-</td>
                                    <td class="px-3 py-2 text-right text-gray-500">-</td>
                                    <td class="px-3 py-2 text-right text-gray-500">-</td>
                                    <td class="px-3 py-2 text-right text-gray-500">-</td>
                                    <td class="px-3 py-2 text-right text-gray-500">-</td>
                                    <td class="px-3 py-2 text-right text-gray-500">-</td>
                                    <td class="px-3 py-2 text-right text-gray-500">-</td>
                                </tr>
                            `;
                        }
                        
                        const totalPnlClass = c.total_pnl >= 0 ? 'text-emerald-400' : 'text-red-400';
                        const longPnlClass = c.long_pnl >= 0 ? 'text-emerald-400' : 'text-red-400';
                        const shortPnlClass = c.short_pnl >= 0 ? 'text-emerald-400' : 'text-red-400';
                        const longPctClass = c.long_pnl_pct >= 0 ? 'text-emerald-400' : 'text-red-400';
                        const shortPctClass = c.short_pnl_pct >= 0 ? 'text-emerald-400' : 'text-red-400';
                        const rrClass = c.risk_reward >= 1 ? 'text-emerald-400' : 'text-red-400';
                        
                        return `
                            <tr class="hover:bg-white/5">
                                <td class="px-3 py-2 ${confColors[conf]} font-medium">${conf}</td>
                                <td class="px-3 py-2 text-center">${c.total_trades} (${c.long_trades}L/${c.short_trades}S)</td>
                                <td class="px-3 py-2 text-right ${totalPnlClass} font-bold">${formatUSD(c.total_pnl)}</td>
                                <td class="px-3 py-2 text-right">${c.total_win_rate.toFixed(0)}%</td>
                                <td class="px-3 py-2 text-right ${rrClass} font-medium">${c.risk_reward > 0 ? c.risk_reward.toFixed(2) : '-'}</td>
                                <td class="px-3 py-2 text-right ${longPnlClass} font-medium">${c.long_trades > 0 ? formatUSD(c.long_pnl) : '-'}</td>
                                <td class="px-3 py-2 text-right ${longPctClass}">${c.long_trades > 0 ? c.long_pnl_pct.toFixed(2) + '%' : '-'}</td>
                                <td class="px-3 py-2 text-right">${c.long_trades > 0 ? c.long_win_rate.toFixed(0) + '%' : '-'}</td>
                                <td class="px-3 py-2 text-right ${shortPnlClass} font-medium">${c.short_trades > 0 ? formatUSD(c.short_pnl) : '-'}</td>
                                <td class="px-3 py-2 text-right ${shortPctClass}">${c.short_trades > 0 ? c.short_pnl_pct.toFixed(2) + '%' : '-'}</td>
                                <td class="px-3 py-2 text-right">${c.short_trades > 0 ? c.short_win_rate.toFixed(0) + '%' : '-'}</td>
                                <td class="px-3 py-2 text-right text-cyan-400">${c.avg_entry_gap != null ? c.avg_entry_gap.toFixed(3) + '%' : '-'}</td>
                            </tr>
                        `;
                    }).join('');
                }
                
                // Trade Outcome Distribution
                const outcomeBody = document.getElementById('outcome-distribution-body');
                if (data.outcome_distribution && data.outcome_distribution.length > 0) {
                    outcomeBody.innerHTML = data.outcome_distribution.map(item => {
                        const countClass = item.count > 0 ? '' : 'text-gray-500';
                        const avgClass = item.avg_pnl_usd >= 0 ? 'text-emerald-400' : 'text-red-400';
                        return `
                            <tr class="hover:bg-white/5">
                                <td class="px-3 py-2 font-medium">${item.range}</td>
                                <td class="px-3 py-2 text-center ${countClass}">${item.count}</td>
                                <td class="px-3 py-2 text-right ${item.count > 0 ? avgClass : 'text-gray-500'}">${item.count > 0 ? formatUSD(item.avg_pnl_usd) : '-'}</td>
                            </tr>
                        `;
                    }).join('');
                } else {
                    outcomeBody.innerHTML = '<tr><td colspan="3" class="px-3 py-4 text-center text-gray-500">No data</td></tr>';
                }
                
                // Closing Reason Summary
                const reasonBody = document.getElementById('close-reason-body');
                if (data.by_close_reason && Object.keys(data.by_close_reason).length > 0) {
                    // Sort reasons: TRAILING_STOP first (L1, L2, L3, L4+), then STOP_LOSS, then others
                    const sortOrder = (reason) => {
                        if (reason.startsWith('TRAILING_STOP')) {
                            const level = reason.includes('L4+') ? 4 : parseInt(reason.split(' L')[1]) || 0;
                            return level;
                        }
                        if (reason.startsWith('STOP_LOSS')) return 100 + (reason.includes('L') ? parseInt(reason.split(' L')[1]) || 0 : 0);
                        if (reason === 'MANUAL') return 200;
                        return 300;
                    };
                    
                    const sortedReasons = Object.entries(data.by_close_reason)
                        .sort((a, b) => sortOrder(a[0]) - sortOrder(b[0]));
                    
                    const confBadgeColors = {
                        'LOW': 'text-yellow-400',
                        'MEDIUM': 'text-orange-400',
                        'HIGH': 'text-emerald-400',
                        'EXTREME': 'text-blue-400'
                    };
                    
                    reasonBody.innerHTML = sortedReasons.map(([reason, stats]) => {
                        const pnlPctClass = stats.avg_pnl_pct >= 0 ? 'text-emerald-400' : 'text-red-400';
                        const pnlUsdClass = stats.avg_pnl_usd >= 0 ? 'text-emerald-400' : 'text-red-400';
                        const isHighLevel = reason.includes('L4+') || (reason.includes(' L') && parseInt(reason.split(' L')[1]) >= 3);
                        const reasonClass = isHighLevel ? 'text-emerald-400 font-medium' : '';
                        
                        // Build confidence badges
                        const confBadges = stats.by_confidence 
                            ? ['LOW', 'MEDIUM', 'HIGH', 'EXTREME']
                                .filter(c => stats.by_confidence[c])
                                .map(c => `<span class="${confBadgeColors[c] || 'text-gray-400'} text-xs">${c[0]}:${stats.by_confidence[c]}</span>`)
                                .join(' ')
                            : '-';
                        
                        return `
                            <tr class="hover:bg-white/5">
                                <td class="px-3 py-2 ${reasonClass}">${reason}</td>
                                <td class="px-3 py-2 text-center">${stats.trades}</td>
                                <td class="px-3 py-2 text-center">${confBadges}</td>
                                <td class="px-3 py-2 text-right ${pnlPctClass}">${stats.avg_pnl_pct >= 0 ? '+' : ''}${stats.avg_pnl_pct.toFixed(2)}%</td>
                                <td class="px-3 py-2 text-right ${pnlUsdClass}">${formatUSD(stats.avg_pnl_usd)}</td>
                            </tr>
                        `;
                    }).join('');
                } else {
                    reasonBody.innerHTML = '<tr><td colspan="5" class="px-3 py-4 text-center text-gray-500">No data</td></tr>';
                }
                
                // Performance by Entry Gap
                const gapBody = document.getElementById('gap-performance-body');
                if (data.gap_performance && data.gap_performance.some(g => g.count > 0)) {
                    const confBadgeColorsGap = {
                        'LOW': 'text-yellow-400',
                        'MEDIUM': 'text-orange-400',
                        'HIGH': 'text-emerald-400',
                        'EXTREME': 'text-blue-400'
                    };
                    
                    gapBody.innerHTML = data.gap_performance.filter(g => g.count > 0).map(g => {
                        const pnlClass = g.avg_pnl_usd >= 0 ? 'text-emerald-400' : 'text-red-400';
                        const totalPnlClass = (g.total_pnl_usd || 0) >= 0 ? 'text-emerald-400' : 'text-red-400';
                        const wrClass = g.win_rate >= 40 ? 'text-emerald-400' : 'text-red-400';
                        
                        // Build confidence badges
                        const confBadges = Object.entries(g.by_confidence || {})
                            .sort((a, b) => b[1] - a[1])
                            .map(([conf, count]) => {
                                const color = confBadgeColorsGap[conf] || 'text-gray-400';
                                return `<span class="${color} text-xs">${conf[0]}:${count}</span>`;
                            }).join(' ');
                        
                        return `
                            <tr class="hover:bg-white/5">
                                <td class="px-3 py-2 font-medium text-cyan-400">${g.range}</td>
                                <td class="px-3 py-2 text-center">${g.count}</td>
                                <td class="px-3 py-2 text-right ${wrClass} font-medium">${g.win_rate.toFixed(0)}%</td>
                                <td class="px-3 py-2 text-right ${totalPnlClass} font-medium">${formatUSD(g.total_pnl_usd || 0)}</td>
                                <td class="px-3 py-2 text-right ${pnlClass} font-medium">${formatUSD(g.avg_pnl_usd)}</td>
                                <td class="px-3 py-2 text-center">${confBadges || '-'}</td>
                            </tr>
                        `;
                    }).join('');
                } else {
                    gapBody.innerHTML = '<tr><td colspan="6" class="px-3 py-4 text-center text-gray-500">No data (collecting entry gaps)</td></tr>';
                }
            } catch (e) {
                console.error('Error loading performance:', e);
            }
        }

        // Update trading pairs limit (controls which pairs are eligible for trading)
        async function updateTradingPairsLimit() {
            const limit = document.getElementById('top-pairs-limit').value;
            try {
                await fetch(`${API_BASE}/api/config/pairs-limit`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ limit: parseInt(limit) })
                });
                showToast(`Trading limited to Top ${limit} pairs`);
                loadPairs();
            } catch (e) {
                console.error('Error updating pairs limit:', e);
                showToast('Error updating pairs limit', 'error');
            }
        }

        // Load pairs
        async function loadPairs() {
            try {
                const limit = document.getElementById('top-pairs-limit')?.value || 50;
                const res = await fetch(`${API_BASE}/api/pairs?limit=${limit}`);
                const data = await res.json();
                
                const tbody = document.getElementById('pairs-table-body');
                
                if (!data || data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="13" class="px-4 py-8 text-center text-gray-500">No pairs data available. Click Refresh to load.</td></tr>';
                    return;
                }
                
                tbody.innerHTML = data.map(p => {
                    const signalClass = p.signal === 'LONG' ? 'bg-emerald-500/20 text-emerald-400' : 
                                       p.signal === 'SHORT' ? 'bg-red-500/20 text-red-400' : 
                                       'bg-yellow-500/20 text-yellow-400';
                    const confidenceClass = p.confidence === 'EXTREME' ? 'text-blue-400' :
                                           p.confidence === 'HIGH' ? 'text-emerald-400' :
                                           p.confidence === 'MEDIUM' ? 'text-orange-400' :
                                           p.confidence === 'LOW' ? 'text-yellow-400' : 'text-gray-400';
                    
                    const longPos = p.open_positions?.long || 0;
                    const shortPos = p.open_positions?.short || 0;
                    let positionsHtml = '';
                    if (longPos > 0) positionsHtml += `<span class="px-2 py-0.5 rounded bg-emerald-500/20 text-emerald-400 text-xs">${longPos}L</span>`;
                    if (shortPos > 0) positionsHtml += `<span class="px-2 py-0.5 rounded bg-red-500/20 text-red-400 text-xs ml-1">${shortPos}S</span>`;
                    if (!positionsHtml) positionsHtml = '<span class="text-gray-500">-</span>';
                    
                    // Format volume (e.g., 1.2B, 500M, 10K)
                    const formatVolume = (vol) => {
                        if (vol >= 1e9) return (vol / 1e9).toFixed(2) + 'B';
                        if (vol >= 1e6) return (vol / 1e6).toFixed(2) + 'M';
                        if (vol >= 1e3) return (vol / 1e3).toFixed(2) + 'K';
                        return vol.toFixed(2);
                    };
                    
                    // Format gap with color
                    const gapValue = p.gap !== null ? p.gap.toFixed(3) + '%' : '-';
                    
                    // Color coding for EMA based on alignment
                    // Green if EMA5 > EMA8 > EMA13 > EMA20 (bullish)
                    // Red if EMA5 < EMA8 < EMA13 < EMA20 (bearish)
                    const isBullishEMA = p.ema5 > p.ema8 && p.ema8 > p.ema13 && p.ema13 > p.ema20;
                    const isBearishEMA = p.ema5 < p.ema8 && p.ema8 < p.ema13 && p.ema13 < p.ema20;
                    const emaColorClass = isBullishEMA ? 'text-emerald-400' : 
                                         isBearishEMA ? 'text-red-400' : '';
                    const gapColorClass = p.signal === 'LONG' ? 'text-emerald-400' : 
                                         p.signal === 'SHORT' ? 'text-red-400' : 
                                         (p.gap > 0 ? 'text-emerald-400/50' : p.gap < 0 ? 'text-red-400/50' : '');
                    
                    return `
                        <tr class="hover:bg-white/5 transition">
                            <td class="px-4 py-3 font-medium">${p.pair}</td>
                            <td class="px-4 py-3 text-right font-mono text-sm text-gray-400">$${formatVolume(p.volume_24h || 0)}</td>
                            <td class="px-4 py-3 text-right font-mono">${formatPrice(p.price)}</td>
                            <td class="px-4 py-3 text-right font-mono text-sm ${emaColorClass}">${formatPrice(p.ema5)}</td>
                            <td class="px-4 py-3 text-right font-mono text-sm ${emaColorClass}">${formatPrice(p.ema8)}</td>
                            <td class="px-4 py-3 text-right font-mono text-sm ${emaColorClass}">${formatPrice(p.ema13)}</td>
                            <td class="px-4 py-3 text-right font-mono text-sm ${emaColorClass}">${formatPrice(p.ema20)}</td>
                            <td class="px-4 py-3 text-right font-mono text-sm ${gapColorClass}">${gapValue}</td>
                            <td class="px-4 py-3 text-right font-mono">${p.rsi !== null ? p.rsi.toFixed(1) : '-'}</td>
                            <td class="px-4 py-3 text-right font-mono">${p.adx !== null ? p.adx.toFixed(1) : '-'}</td>
                            <td class="px-4 py-3 text-center ${confidenceClass} font-medium">${p.confidence || '-'}</td>
                            <td class="px-4 py-3 text-center">
                                <span class="px-2 py-1 rounded text-xs font-medium ${signalClass}">${p.signal || 'NOTHING'}</span>
                            </td>
                            <td class="px-4 py-3 text-center">${positionsHtml}</td>
                        </tr>
                    `;
                }).join('');
            } catch (e) {
                console.error('Error loading pairs:', e);
            }
        }

        // Refresh pairs manually
        async function refreshPairs() {
            try {
                document.getElementById('pairs-table-body').innerHTML = '<tr><td colspan="13" class="px-4 py-8 text-center text-gray-500">Refreshing...</td></tr>';
                await fetch(`${API_BASE}/api/pairs/refresh`, { method: 'POST' });
                await loadPairs();
                showToast('Pairs data refreshed');
            } catch (e) {
                console.error('Error refreshing pairs:', e);
                showToast('Error refreshing pairs', 'error');
            }
        }

        // Switch orders tab
        function switchOrdersTab(tab) {
            currentTab = tab;
            
            ['transactions', 'open', 'closed'].forEach(t => {
                document.getElementById(`tab-${t}`).classList.remove('tab-active');
                document.getElementById(`content-${t}`).classList.add('hidden');
            });
            
            document.getElementById(`tab-${tab}`).classList.add('tab-active');
            document.getElementById(`content-${tab}`).classList.remove('hidden');
            
            // Load fresh data when switching tabs
            if (tab === 'transactions') loadTransactions();
            else if (tab === 'open') loadOpenOrders();
            else if (tab === 'closed') {
                loadClosedOrders();
                loadPerformance();
            }
        }

        // Load transactions
        async function loadTransactions() {
            try {
                const res = await fetch(`${API_BASE}/api/transactions`);
                const data = await res.json();
                
                const tbody = document.getElementById('transactions-table-body');
                
                if (!data || data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="11" class="px-4 py-8 text-center text-gray-500">No transactions yet</td></tr>';
                    return;
                }
                
                tbody.innerHTML = data.map(t => {
                    const actionClass = t.action.includes('LONG') ? 'text-emerald-400' : 'text-red-400';
                    const confClass = getConfidenceClass(t.confidence);
                    return `
                        <tr class="hover:bg-white/5 transition">
                            <td class="px-4 py-3 text-sm">${formatTime(t.timestamp)}</td>
                            <td class="px-4 py-3 text-sm font-mono">${t.binance_order_id || t.order_id}</td>
                            <td class="px-4 py-3 font-medium">${t.pair}</td>
                            <td class="px-4 py-3 ${confClass}">${t.confidence || '-'}</td>
                            <td class="px-4 py-3 ${actionClass} font-medium">${t.action}</td>
                            <td class="px-4 py-3 text-right font-mono">${t.quantity.toFixed(6)}</td>
                            <td class="px-4 py-3 text-right font-mono">${formatPrice(t.price)}</td>
                            <td class="px-4 py-3 text-right">${formatUSD(t.investment)}</td>
                            <td class="px-4 py-3 text-right">${t.leverage}x</td>
                            <td class="px-4 py-3 text-right">${formatUSD(t.notional_value)}</td>
                            <td class="px-4 py-3 text-right text-yellow-400">${formatUSD(t.fee)}</td>
                        </tr>
                    `;
                }).join('');
            } catch (e) {
                console.error('Error loading transactions:', e);
            }
        }

        // Load open orders
        async function loadOpenOrders() {
            try {
                const res = await fetch(`${API_BASE}/api/orders/open`);
                const data = await res.json();
                
                const tbody = document.getElementById('open-orders-table-body');
                
                if (!data || data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="16" class="px-4 py-8 text-center text-gray-500">No open orders</td></tr>';
                    return;
                }
                
                tbody.innerHTML = data.map(o => {
                    const dirClass = o.direction === 'LONG' ? 'text-emerald-400' : 'text-red-400';
                    const pnlClass = o.pnl >= 0 ? 'text-emerald-400' : 'text-red-400';
                    const confClass = getConfidenceClass(o.confidence);
                    const highLow = o.direction === 'LONG' ? o.high_since_entry : o.low_since_entry;
                    
                    // TP Level display
                    const tpLevel = o.tp_level || 1;
                    const tpTarget = o.tp_target || 0;
                    const tpLevelClass = tpLevel > 1 ? 'text-emerald-400 font-medium' : 'text-gray-400';
                    
                    return `
                        <tr class="hover:bg-white/5 transition">
                            <td class="px-4 py-3 text-sm">${formatTime(o.opened_at)}</td>
                            <td class="px-4 py-3 font-medium">${o.pair}</td>
                            <td class="px-4 py-3 ${confClass}">${o.confidence || '-'}</td>
                            <td class="px-4 py-3 ${dirClass} font-medium">${o.direction}</td>
                            <td class="px-4 py-3 text-right">${formatUSD(o.investment)}</td>
                            <td class="px-4 py-3 text-right">${o.leverage}x</td>
                            <td class="px-4 py-3 text-right">${formatUSD(o.notional_value)}</td>
                            <td class="px-4 py-3 text-right font-mono">${formatPrice(o.entry_price)}</td>
                            <td class="px-4 py-3 text-right font-mono">${formatPrice(o.current_price)}</td>
                            <td class="px-4 py-3 text-right text-yellow-400">${formatUSD(o.entry_fee)}</td>
                            <td class="px-4 py-3 text-right font-mono">${formatPrice(highLow)}</td>
                            <td class="px-4 py-3 text-right">${o.drop_from_peak.toFixed(2)}%</td>
                            <td class="px-4 py-3 text-right ${pnlClass} font-medium">${formatUSD(o.pnl)} (${o.pnl_percentage.toFixed(2)}%)</td>
                            <td class="px-4 py-3 text-center ${tpLevelClass}">L${tpLevel} (${tpTarget.toFixed(2)}%)</td>
                            <td class="px-4 py-3 text-right font-mono">${o.duration}</td>
                            <td class="px-4 py-3 text-center">
                                <button onclick="closeOrder(${o.id})" class="px-3 py-1 bg-red-500/20 hover:bg-red-500/40 text-red-400 rounded text-xs font-medium transition">
                                    Close
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
            } catch (e) {
                console.error('Error loading open orders:', e);
            }
        }

        // Load closed orders
        async function loadClosedOrders() {
            try {
                const res = await fetch(`${API_BASE}/api/orders/closed`);
                const data = await res.json();
                
                const tbody = document.getElementById('closed-orders-table-body');
                
                if (!data || data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="14" class="px-4 py-8 text-center text-gray-500">No closed orders</td></tr>';
                    return;
                }
                
                tbody.innerHTML = data.map(o => {
                    const dirClass = o.direction === 'LONG' ? 'text-emerald-400' : 'text-red-400';
                    const pnlClass = o.pnl >= 0 ? 'text-emerald-400' : 'text-red-400';
                    const confClass = getConfidenceClass(o.confidence);
                    
                    // TP Level display
                    const tpLevel = o.tp_level || 1;
                    const tpLevelClass = tpLevel > 1 ? 'text-emerald-400 font-medium' : 'text-gray-400';
                    
                    return `
                        <tr class="hover:bg-white/5 transition">
                            <td class="px-4 py-3 text-sm">${formatTime(o.opened_at)}</td>
                            <td class="px-4 py-3 text-sm">${formatTime(o.closed_at)}</td>
                            <td class="px-4 py-3 font-medium">${o.pair}</td>
                            <td class="px-4 py-3 ${confClass}">${o.confidence || '-'}</td>
                            <td class="px-4 py-3 ${dirClass} font-medium">${o.direction}</td>
                            <td class="px-4 py-3 text-right">${formatUSD(o.investment)}</td>
                            <td class="px-4 py-3 text-right">${o.leverage}x</td>
                            <td class="px-4 py-3 text-right font-mono">${formatPrice(o.entry_price)}</td>
                            <td class="px-4 py-3 text-right font-mono">${formatPrice(o.exit_price)}</td>
                            <td class="px-4 py-3 text-right text-yellow-400">${formatUSD(o.total_fee)}</td>
                            <td class="px-4 py-3 text-right ${pnlClass} font-medium">${formatUSD(o.pnl)} (${o.pnl_percentage.toFixed(2)}%)</td>
                            <td class="px-4 py-3 text-center ${tpLevelClass}">L${tpLevel}</td>
                            <td class="px-4 py-3 text-right font-mono">${o.duration}</td>
                            <td class="px-4 py-3 text-xs">${o.close_reason}</td>
                        </tr>
                    `;
                }).join('');
            } catch (e) {
                console.error('Error loading closed orders:', e);
            }
        }

        // Close order manually
        async function closeOrder(orderId) {
            if (!confirm('Are you sure you want to close this position?')) return;
            
            try {
                const res = await fetch(`${API_BASE}/api/orders/close`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ order_id: orderId })
                });
                
                if (res.ok) {
                    showToast('Position closed successfully');
                    loadOpenOrders();
                    loadClosedOrders();
                    loadTransactions();
                    loadPerformance();
                    loadBalance();
                } else {
                    const data = await res.json();
                    showToast(data.detail || 'Error closing position', 'error');
                }
            } catch (e) {
                console.error('Error closing order:', e);
                showToast('Error closing position', 'error');
            }
        }

        // Load configuration
        async function loadConfig() {
            try {
                const res = await fetch(`${API_BASE}/api/config`);
                const config = await res.json();
                
                // Investment settings
                document.getElementById('config-investment-mode').value = config.investment.mode;
                document.getElementById('config-investment-value').value = config.investment.mode === 'percentage' ? config.investment.percentage : config.investment.fixed_amount;
                // Display fee as percentage (multiply by 100)
                document.getElementById('config-trading-fee').value = (config.trading_fee * 100).toFixed(4);
                document.getElementById('config-reserve-mode').value = config.investment.reserve_mode;
                document.getElementById('config-reserve-value').value = config.investment.reserve_mode === 'percentage' ? config.investment.reserve_percentage : config.investment.reserve_fixed;
                document.getElementById('config-paper-balance').value = config.paper_balance;
                document.getElementById('config-cooldown-loss').value = config.investment.cooldown_after_loss_minutes || 5;
                document.getElementById('config-max-positions').value = config.investment.max_open_positions || 100;
                document.getElementById('config-min-investment').value = config.investment.min_investment_size || 100;
                document.getElementById('config-max-investment').value = config.investment.max_investment_size || 50000;
                document.getElementById('config-max-holding-time').value = config.investment.max_holding_time_minutes !== undefined ? config.investment.max_holding_time_minutes : 180;
                
                // Trading pairs limit
                document.getElementById('top-pairs-limit').value = config.trading_pairs_limit || 50;
                
                updateInvestmentUnit();
                updateReserveUnit();
                
                // Signal thresholds
                document.getElementById('config-long-rsi-extreme').value = config.thresholds.long_rsi_extreme;
                document.getElementById('config-long-rsi-high').value = config.thresholds.long_rsi_high;
                document.getElementById('config-long-rsi-medium').value = config.thresholds.long_rsi_medium;
                document.getElementById('config-long-rsi-low').value = config.thresholds.long_rsi_low;
                document.getElementById('config-short-rsi-extreme').value = config.thresholds.short_rsi_extreme;
                document.getElementById('config-short-rsi-high').value = config.thresholds.short_rsi_high;
                document.getElementById('config-short-rsi-medium').value = config.thresholds.short_rsi_medium;
                document.getElementById('config-short-rsi-low').value = config.thresholds.short_rsi_low;
                document.getElementById('config-adx-low').value = config.thresholds.adx_low;
                document.getElementById('config-adx-medium').value = config.thresholds.adx_medium;
                document.getElementById('config-adx-high').value = config.thresholds.adx_high;
                document.getElementById('config-adx-extreme').value = config.thresholds.adx_extreme;
                document.getElementById('config-volume-mult').value = config.thresholds.volume_multiplier;
                
                // Confidence levels
                ['low', 'medium', 'high', 'extreme'].forEach(level => {
                    const cfg = config.confidence_levels[level.toUpperCase()];
                    if (cfg) {
                        document.getElementById(`config-${level}-mode`).value = cfg.enabled === false ? 'disabled' : (cfg.trade_mode || 'both');
                        document.getElementById(`config-${level}-leverage`).value = cfg.leverage;
                        document.getElementById(`config-${level}-multiplier`).value = cfg.investment_multiplier || 1.0;
                        document.getElementById(`config-${level}-sl`).value = cfg.stop_loss;
                        document.getElementById(`config-${level}-tp`).value = cfg.tp_min;
                        document.getElementById(`config-${level}-pb`).value = cfg.pullback_trigger;
                        document.getElementById(`config-${level}-gap-min`).value = cfg.gap_min !== undefined ? cfg.gap_min : 0.08;
                        document.getElementById(`config-${level}-gap-max`).value = cfg.gap_max !== undefined ? cfg.gap_max : 0.40;
                        document.getElementById(`config-${level}-gap-enabled`).checked = cfg.gap_enabled !== false;
                        document.getElementById(`config-${level}-be-trigger`).value = cfg.breakeven_trigger !== undefined ? cfg.breakeven_trigger : 0.15;
                        document.getElementById(`config-${level}-be-offset`).value = cfg.breakeven_offset !== undefined ? cfg.breakeven_offset : -0.05;
                    }
                });
            } catch (e) {
                console.error('Error loading config:', e);
            }
        }

        // Update investment unit display
        function updateInvestmentUnit() {
            const mode = document.getElementById('config-investment-mode').value;
            document.getElementById('config-investment-unit').textContent = mode === 'percentage' ? '%' : 'USD';
        }

        function updateReserveUnit() {
            const mode = document.getElementById('config-reserve-mode').value;
            document.getElementById('config-reserve-unit').textContent = mode === 'percentage' ? '%' : 'USD';
        }

        document.getElementById('config-investment-mode').addEventListener('change', updateInvestmentUnit);
        document.getElementById('config-reserve-mode').addEventListener('change', updateReserveUnit);

        // Save configuration
        async function saveConfig() {
            const invMode = document.getElementById('config-investment-mode').value;
            const invValue = parseFloat(document.getElementById('config-investment-value').value);
            const resMode = document.getElementById('config-reserve-mode').value;
            const resValue = parseFloat(document.getElementById('config-reserve-value').value);
            
            const config = {
                // Convert percentage input to decimal (divide by 100)
                trading_fee: parseFloat(document.getElementById('config-trading-fee').value) / 100,
                paper_balance: parseFloat(document.getElementById('config-paper-balance').value),
                investment: {
                    mode: invMode,
                    fixed_amount: invMode === 'fixed' ? invValue : 100,
                    percentage: invMode === 'percentage' ? invValue : 5,
                    reserve_mode: resMode,
                    reserve_fixed: resMode === 'fixed' ? resValue : 500,
                    reserve_percentage: resMode === 'percentage' ? resValue : 20,
                    cooldown_after_loss_minutes: parseInt(document.getElementById('config-cooldown-loss').value) || 5,
                    max_open_positions: parseInt(document.getElementById('config-max-positions').value) || 100,
                    min_investment_size: parseFloat(document.getElementById('config-min-investment').value) || 100,
                    max_investment_size: parseFloat(document.getElementById('config-max-investment').value) || 50000,
                    max_holding_time_minutes: parseInt(document.getElementById('config-max-holding-time').value) || 0
                },
                thresholds: {
                    long_rsi_extreme: parseFloat(document.getElementById('config-long-rsi-extreme').value),
                    long_rsi_high: parseFloat(document.getElementById('config-long-rsi-high').value),
                    long_rsi_medium: parseFloat(document.getElementById('config-long-rsi-medium').value),
                    long_rsi_low: parseFloat(document.getElementById('config-long-rsi-low').value),
                    short_rsi_extreme: parseFloat(document.getElementById('config-short-rsi-extreme').value),
                    short_rsi_high: parseFloat(document.getElementById('config-short-rsi-high').value),
                    short_rsi_medium: parseFloat(document.getElementById('config-short-rsi-medium').value),
                    short_rsi_low: parseFloat(document.getElementById('config-short-rsi-low').value),
                    adx_low: parseFloat(document.getElementById('config-adx-low').value),
                    adx_medium: parseFloat(document.getElementById('config-adx-medium').value),
                    adx_high: parseFloat(document.getElementById('config-adx-high').value),
                    adx_extreme: parseFloat(document.getElementById('config-adx-extreme').value),
                    volume_multiplier: parseFloat(document.getElementById('config-volume-mult').value)
                },
                confidence_levels: {}
            };
            
            ['low', 'medium', 'high', 'extreme'].forEach(level => {
                const tradeMode = document.getElementById(`config-${level}-mode`).value;
                config.confidence_levels[level.toUpperCase()] = {
                    enabled: tradeMode !== 'disabled',
                    trade_mode: tradeMode === 'disabled' ? 'both' : tradeMode,
                    leverage: parseFloat(document.getElementById(`config-${level}-leverage`).value),
                    investment_multiplier: parseFloat(document.getElementById(`config-${level}-multiplier`).value),
                    stop_loss: parseFloat(document.getElementById(`config-${level}-sl`).value),
                    tp_min: parseFloat(document.getElementById(`config-${level}-tp`).value),
                    pullback_trigger: parseFloat(document.getElementById(`config-${level}-pb`).value),
                    gap_min: parseFloat(document.getElementById(`config-${level}-gap-min`).value),
                    gap_max: parseFloat(document.getElementById(`config-${level}-gap-max`).value),
                    gap_enabled: document.getElementById(`config-${level}-gap-enabled`).checked,
                    breakeven_trigger: parseFloat(document.getElementById(`config-${level}-be-trigger`).value),
                    breakeven_offset: parseFloat(document.getElementById(`config-${level}-be-offset`).value)
                };
            });
            
            try {
                const res = await fetch(`${API_BASE}/api/config`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });
                
                if (res.ok) {
                    showToast('Configuration saved successfully');
                } else {
                    const data = await res.json();
                    showToast(data.detail || 'Error saving configuration', 'error');
                }
            } catch (e) {
                console.error('Error saving config:', e);
                showToast('Error saving configuration', 'error');
            }
        }
    </script>
</body>
</html>
